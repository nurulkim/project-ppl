<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Media Interaktif - Setrika Listrik</title>
<style>
  body {
    font-family: "Poppins", sans-serif;
    background: linear-gradient(135deg, #e3f2fd, #f3f5f7);
    margin: 0;
    padding: 0;
    display: flex;
    flex-direction: column;
    align-items: center;
  }

  #btnBack {
    position: fixed;
    top: 15px;
    left: 15px;
    background: #4a90e2;
    color: white;
    border: none;
    border-radius: 50%;
    width: 48px;
    height: 48px;
    font-size: 22px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    box-shadow: 0 3px 6px rgba(0,0,0,0.2);
    z-index: 999;
    transition: 0.3s;
  }

  #btnBack:hover { background: #3578d3; transform: scale(1.05); }

  h2 { text-align: center; color: #2a4d8f; margin: 70px 0 20px; }

  #controls {
    display: flex; gap: 10px; margin-bottom: 15px; flex-wrap: wrap; justify-content: center;
  }
  #controls button { padding: 8px 14px; border: none; border-radius: 6px; background: #e0e0e0; cursor: pointer; font-size: 15px; transition: 0.2s; }
  #controls button.active { background: #4a90e2; color: white; }

  #canvasWrapper {
    position: relative;
    width: 90%;
    max-width: 900px;
    height: 500px;
    border: 2px solid #ccc;
    border-radius: 12px;
    background: white;
    overflow: hidden;
  }

  #drawCanvas {
    position: absolute;
    top: 0; left: 0;
    width: 100%;
    height: 100%;
    z-index: 1;
  }

  #elements-layer {
    position: absolute;
    top:0; left:0;
    width: 100%; height: 100%;
    z-index: 2;
  }

  #elemenList {
    display: flex; justify-content: center; gap: 10px; flex-wrap: wrap; margin-top: 20px;
  }

  .elemen {
    width: 100px; height: 100px;
    border: 2px solid #ccc;
    border-radius: 8px;
    background: white;
    display: flex; align-items: center; justify-content: center;
    cursor: grab;
  }

  .elemen img { width: 80%; height: 80%; object-fit: contain; pointer-events: none; }

  .resizable {
    position: absolute;
    border: 1px dashed #aaa;
    border-radius: 6px;
    background: transparent;
    cursor: move;
  }

  .resizable img { width: 100%; height: 100%; object-fit: contain; pointer-events: none; }

  .resize-handle {
    position: absolute; bottom: 0; right: 0;
    width: 14px; height: 14px;
    background: #4a90e2; border-radius: 50%;
    cursor: se-resize;
  }

</style>
</head>
<body>

<button id="btnBack" onclick="window.location.href='index.html'">‚¨ÖÔ∏è</button>
<h2>üß∞ Media Pembelajaran: Merangkai Elemen Setrika</h2>

<div id="controls">
  <button id="modeDraw" class="active">‚úèÔ∏è Mode Gambar</button>
  <button id="modeElemen">üñ±Ô∏è Drag & Drop</button>
  <button id="undo">‚Ü©Ô∏è Undo</button>
  <label>Color:
    <select id="selColor">
      <option value="black">Black</option>
      <option value="blue" selected>Blue</option>
      <option value="red">Red</option>
      <option value="green">Green</option>
    </select>
  </label>
  <label>Width:
    <select id="selWidth">
      <option value="2">2</option>
      <option value="4" selected>4</option>
      <option value="6">6</option>
    </select>
  </label>
</div>

<div id="canvasWrapper">
  <canvas id="drawCanvas"></canvas>
  <div id="elements-layer"></div>
</div>

<div id="elemenList">
  <div class="elemen" id="elemenA"><img src="assets/titikA.png" alt="A"></div>
  <div class="elemen" id="elemenB"><img src="assets/titikB.png" alt="B"></div>
  <div class="elemen" id="elemenC"><img src="assets/titikC.png" alt="C"></div>
</div>

<script>
// ===== Canvas garis =====
const canvas = document.getElementById('drawCanvas');
const ctx = canvas.getContext('2d');
canvas.width = canvas.offsetWidth;
canvas.height = canvas.offsetHeight;

let drawing = false, startX=0, startY=0;
let lines = [];

const selColor = document.getElementById('selColor');
const selWidth = document.getElementById('selWidth');

const btnDraw = document.getElementById('modeDraw');
const btnElemen = document.getElementById('modeElemen');
const btnUndo = document.getElementById('undo');

let mode = 'draw';

btnDraw.onclick = ()=>setMode('draw');
btnElemen.onclick = ()=>setMode('elemen');
btnUndo.onclick = ()=>{ lines.pop(); redrawAll(); };

function setMode(m){
  mode=m;
  btnDraw.classList.toggle('active', m==='draw');
  btnElemen.classList.toggle('active', m==='elemen');
  canvas.style.pointerEvents = (m==='draw') ? 'auto':'none';
}

// Touch & mouse drawing
function getPos(e){
  let rect = canvas.getBoundingClientRect();
  if(e.touches) {
    return {x: e.touches[0].clientX - rect.left, y: e.touches[0].clientY - rect.top};
  } else {
    return {x: e.clientX - rect.left, y: e.clientY - rect.top};
  }
}

function startDraw(e){ if(mode!=='draw') return; drawing=true; let p=getPos(e); startX=p.x; startY=p.y; e.preventDefault(); }
function moveDraw(e){ if(!drawing || mode!=='draw') return; let p=getPos(e); ctx.beginPath(); ctx.moveTo(startX,startY); ctx.lineTo(p.x,p.y); ctx.strokeStyle=selColor.value; ctx.lineWidth=selWidth.value; ctx.lineCap='round'; ctx.stroke(); startX=p.x; startY=p.y; e.preventDefault(); }
function endDraw(e){ if(mode!=='draw') return; drawing=false; lines.push(ctx.getImageData(0,0,canvas.width,canvas.height)); e.preventDefault(); }

canvas.addEventListener('mousedown', startDraw);
canvas.addEventListener('mousemove', moveDraw);
canvas.addEventListener('mouseup', endDraw);
canvas.addEventListener('mouseout', endDraw);

canvas.addEventListener('touchstart', startDraw);
canvas.addEventListener('touchmove', moveDraw);
canvas.addEventListener('touchend', endDraw);

function redrawAll(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  for(let snap of lines) ctx.putImageData(snap,0,0);
}

// ===== Drag & drop elemen =====
const elementsLayer = document.getElementById('elements-layer');
document.querySelectorAll('.elemen').forEach(el=>{
  el.addEventListener('touchend', e=>{
    e.preventDefault();
    const rect = elementsLayer.getBoundingClientRect();
    const x = e.changedTouches[0].clientX - rect.left - 50;
    const y = e.changedTouches[0].clientY - rect.top - 50;
    createDrop(el,x,y);
  });
  el.addEventListener('mousedown', e=>{
    const rect = elementsLayer.getBoundingClientRect();
    createDrop(el,e.clientX - rect.left - 50, e.clientY - rect.top - 50);
  });
});

function createDrop(el,x,y){
  const clone=document.createElement('div');
  clone.className='resizable';
  clone.style.left=x+'px';
  clone.style.top=y+'px';
  clone.style.width='100px';
  clone.style.height='100px';
  const img=document.createElement('img');
  img.src=el.querySelector('img').src;
  clone.appendChild(img);
  const handle=document.createElement('div');
  handle.className='resize-handle';
  clone.appendChild(handle);
  elementsLayer.appendChild(clone);
  makeDraggable(clone);
  makeResizable(clone,handle);
}

function makeDraggable(el){
  let dragging=false, ox, oy;
  el.addEventListener('touchstart', e=>{
    if(e.target.classList.contains('resize-handle')) return;
    const t=e.touches[0]; dragging=true; ox=t.clientX - el.offsetLeft; oy=t.clientY - el.offsetTop;
  });
  document.addEventListener('touchmove', e=>{
    if(!dragging) return;
    const t=e.touches[0];
    el.style.left = t.clientX - ox + 'px';
    el.style.top = t.clientY - oy + 'px';
  });
  document.addEventListener('touchend', ()=>dragging=false);

  el.addEventListener('mousedown', e=>{
    if(e.target.classList.contains('resize-handle')) return;
    dragging=true; ox=e.clientX - el.offsetLeft; oy=e.clientY - el.offsetTop;
    function move(e){ if(dragging){ el.style.left=e.clientX - ox+'px'; el.style.top=e.clientY - oy+'px'; } }
    function up(){ dragging=false; document.removeEventListener('mousemove',move); document.removeEventListener('mouseup',up);}
    document.addEventListener('mousemove',move);
    document.addEventListener('mouseup',up);
  });
}

function makeResizable(el,handle){
  let resizing=false, sx, sy, sw, sh;
  handle.addEventListener('touchstart', e=>{
    e.preventDefault();
    const t=e.touches[0];
    resizing=true; sx=t.clientX; sy=t.clientY; sw=el.offsetWidth; sh=el.offsetHeight;
  });
  document.addEventListener('touchmove', e=>{
    if(!resizing) return;
    const t=e.touches[0];
    el.style.width = Math.max(60, sw + t.clientX - sx)+'px';
    el.style.height = Math.max(60, sh + t.clientY - sy)+'px';
  });
  document.addEventListener('touchend', ()=>resizing=false);

  handle.addEventListener('mousedown', e=>{
    e.preventDefault();
    resizing=true; sx=e.clientX; sy=e.clientY; sw=el.offsetWidth; sh=el.offsetHeight;
    function move(e){ if(resizing){ el.style.width=Math.max(60, sw+e.clientX-sx)+'px'; el.style.height=Math.max(60, sh+e.clientY-sy)+'px'; } }
    function up(){ resizing=false; document.removeEventListener('mousemove',move); document.removeEventListener('mouseup',up);}
    document.addEventListener('mousemove',move);
    document.addEventListener('mouseup',up);
  });
}

</script>
</body>
</html>
